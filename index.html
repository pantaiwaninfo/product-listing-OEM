<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OEMå®˜ç¶²ç”¢å“ä¸Šæ¶åŠç¶­è­·ç®¡ç†ç³»çµ±</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #9C8B7A 0%, #B5A491 100%);
min-height: 100vh;
color: #333;
line-height: 1.6;
}

.container {
max-width: 1400px;
margin: 0 auto;
padding: 20px;
}

.header {
text-align: center;
margin-bottom: 30px;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(10px);
padding: 40px;
border-radius: 20px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
}

.header h1 {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
font-size: 2.8em;
margin-bottom: 15px;
font-weight: 700;
letter-spacing: -1px;
}

.mode-indicator {
display: inline-block;
padding: 10px 25px;
border-radius: 25px;
font-weight: 600;
margin-top: 15px;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 1px;
}

.mode-selector {
margin-bottom: 20px;
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
}

.mode-selector label {
font-weight: 600;
color: #5D5A57;
font-size: 16px;
}

.mode-selector select {
padding: 12px 20px;
border: 2px solid transparent;
border-radius: 12px;
font-size: 14px;
font-weight: 600;
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
color: white;
cursor: pointer;
transition: all 0.3s ease;
}

.mode-selector select:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(125, 110, 131, 0.4);
}

.mode-selector select:focus {
outline: none;
box-shadow: 0 0 0 3px rgba(125, 110, 131, 0.3);
}

.mode-selector select option {
background: white;
color: #333;
padding: 10px;
}

.mode-new {
background: linear-gradient(135deg, #A4B5A0 0%, #C8D5C1 100%);
color: white;
box-shadow: 0 4px 15px rgba(164, 181, 160, 0.3);
}

.mode-update {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
color: white;
box-shadow: 0 4px 15px rgba(125, 110, 131, 0.3);
}

.basic-info, .ai-content {
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
padding: 35px;
border-radius: 20px;
margin-bottom: 25px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
transition: transform 0.3s ease;
}

.basic-info:hover, .ai-content:hover {
transform: translateY(-2px);
}

.basic-info h2, .ai-content h2 {
font-size: 1.8em;
margin-bottom: 30px;
font-weight: 700;
position: relative;
padding-bottom: 15px;
}

.basic-info h2 {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
}

.basic-info h2::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
width: 60px;
height: 4px;
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
border-radius: 2px;
}

.ai-content h2 {
color: #B5A491;
}

.ai-content h2::after {
content: '';
position: absolute;
bottom: 0;
left: 0;
width: 60px;
height: 4px;
background: linear-gradient(135deg, #B5A491 0%, #C8D5C1 100%);
border-radius: 2px;
}

.form-row {
display: flex;
gap: 25px;
margin-bottom: 25px;
align-items: end;
}

.form-group {
flex: 1;
}

.form-group label {
display: block;
margin-bottom: 10px;
font-weight: 600;
color: #5D5A57;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.required {
color: #D4A574;
font-weight: 700;
}

.form-group input, .form-group textarea, .form-group select {
width: 100%;
padding: 15px 20px;
border: 2px solid #E8E6E1;
border-radius: 12px;
font-size: 15px;
transition: all 0.3s ease;
background: rgba(255, 255, 255, 0.8);
backdrop-filter: blur(5px);
}

.form-group select {
cursor: pointer;
}

.form-group input:focus, .form-group textarea:focus, .form-group select:focus {
outline: none;
border-color: #7D6E83;
box-shadow: 0 0 0 3px rgba(125, 110, 131, 0.1);
transform: translateY(-1px);
}

.form-group input:disabled, .form-group select:disabled {
background-color: #f5f5f5;
color: #6c757d;
cursor: not-allowed;
}

.custom-input-container {
display: none;
margin-top: 10px;
}

.custom-input-container.show {
display: block;
}

.check-btn {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
color: white;
border: none;
padding: 15px 25px;
border-radius: 12px;
cursor: pointer;
font-weight: 600;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 1px;
font-size: 14px;
}

.check-btn:hover {
transform: translateY(-3px);
box-shadow: 0 10px 25px rgba(125, 110, 131, 0.4);
}

.generate-btn {
background: linear-gradient(135deg, #A4B5A0 0%, #C8D5C1 100%);
color: white;
border: none;
padding: 18px 40px;
border-radius: 50px;
font-size: 16px;
font-weight: 700;
cursor: pointer;
margin: 30px auto;
display: block;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 1px;
position: relative;
overflow: hidden;
}

.generate-btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.generate-btn:hover::before {
left: 100%;
}

.generate-btn:hover {
transform: translateY(-3px);
box-shadow: 0 15px 35px rgba(164, 181, 160, 0.4);
}

.generate-btn:disabled {
background: linear-gradient(135deg, #9B9B9B 0%, #7A7A7A 100%);
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.warning-text {
background: linear-gradient(135deg, #F4F1EC 0%, #E8E3DD 100%);
color: #7D6E83;
padding: 15px 20px;
border-radius: 12px;
margin-bottom: 25px;
border-left: 5px solid #B5A491;
font-weight: 600;
display: flex;
align-items: center;
gap: 10px;
}

.section {
margin-bottom: 35px;
}

.section-title {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
color: white;
padding: 15px 25px;
margin-bottom: 20px;
border-radius: 12px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
justify-content: space-between;
box-shadow: 0 4px 15px rgba(125, 110, 131, 0.3);
}

.section-title:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(125, 110, 131, 0.4);
}

.section-title::before {
content: "â–¼";
font-size: 12px;
transition: transform 0.3s ease;
}

.section.collapsed .section-title::before {
transform: rotate(-90deg);
}

.section.collapsed .section-content {
display: none;
}

.field-row {
display: flex;
gap: 25px;
margin-bottom: 25px;
align-items: stretch;
}

.original-data, .ai-data {
flex: 1;
border-radius: 15px;
padding: 20px;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.original-data {
background: linear-gradient(135deg, #F4F1EC 0%, #E8E3DD 100%);
border: 2px solid #D4D0CB;
}

.original-data .field-content {
white-space: pre-line;
}

.original-data::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: linear-gradient(135deg, #9B9B9B 0%, #7A7A7A 100%);
}

.ai-data {
background: linear-gradient(135deg, #F0F3F0 0%, #E5EBE5 100%);
border: 2px solid #A4B5A0;
}

.ai-data::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
}

.field-header {
font-weight: 700;
margin-bottom: 15px;
color: #5D5A57;
font-size: 14px;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.field-content {
min-height: 60px;
}

.field-content textarea, .field-content input {
width: 100%;
min-height: 80px;
border: 2px solid #E8E6E1;
border-radius: 10px;
padding: 12px 15px;
resize: vertical;
font-family: inherit;
transition: all 0.3s ease;
background: rgba(255, 255, 255, 0.9);
}

.review-badge {
background: linear-gradient(135deg, #D4A574 0%, #B5A491 100%);
color: white;
padding: 3px 8px;
border-radius: 12px;
font-size: 11px;
font-weight: 700;
margin-left: 8px;
text-transform: uppercase;
letter-spacing: 0.5px;
box-shadow: 0 2px 4px rgba(212, 165, 116, 0.3);
animation: pulse 2s infinite;
}

@keyframes pulse {
0% { box-shadow: 0 2px 4px rgba(212, 165, 116, 0.3); }
50% { box-shadow: 0 2px 8px rgba(212, 165, 116, 0.6); }
100% { box-shadow: 0 2px 4px rgba(212, 165, 116, 0.3); }
}

#aiIntroduction {
min-height: 180px;
}

#aiDetailedDesc {
min-height: 180px;
}

#aiFeatures {
min-height: 180px;
}

#aiSpecs {
min-height: 150px;
}

#aiMedia1,
#aiMedia2,
#aiMedia3 {
min-height: 180px;
}

.field-content textarea:focus, .field-content input:focus {
border-color: #7D6E83;
box-shadow: 0 0 0 3px rgba(125, 110, 131, 0.1);
outline: none;
}

.refresh-btn {
background: linear-gradient(135deg, #A4B5A0 0%, #C8D5C1 100%);
color: white;
border: none;
padding: 8px 15px;
border-radius: 20px;
cursor: pointer;
font-size: 12px;
font-weight: 600;
margin-top: 10px;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.refresh-btn:hover {
transform: translateY(-2px);
box-shadow: 0 5px 15px rgba(164, 181, 160, 0.4);
}

.refresh-btn:disabled {
background: linear-gradient(135deg, #9B9B9B 0%, #7A7A7A 100%);
cursor: not-allowed;
transform: none;
box-shadow: none;
}

.loading {
display: none;
text-align: center;
padding: 30px;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
border-radius: 20px;
margin-bottom: 25px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.loading.show {
display: block;
}

.loading-content {
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
color: #7D6E83;
font-weight: 600;
font-size: 18px;
}

.spinner {
display: inline-block;
animation: spin 2s linear infinite;
font-size: 24px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.action-buttons {
text-align: center;
padding: 40px;
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(15px);
border-radius: 20px;
box-shadow: 0 8px 32px rgba(0,0,0,0.1);
border: 1px solid rgba(255, 255, 255, 0.2);
}

.action-btn {
padding: 15px 35px;
margin: 0 15px;
border: none;
border-radius: 50px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
text-transform: uppercase;
letter-spacing: 1px;
position: relative;
overflow: hidden;
}

.action-btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
transition: left 0.5s;
}

.action-btn:hover::before {
left: 100%;
}

.save-btn {
background: linear-gradient(135deg, #A4B5A0 0%, #C8D5C1 100%);
color: white;
box-shadow: 0 4px 15px rgba(164, 181, 160, 0.3);
}

.save-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(164, 181, 160, 0.4);
}

.preview-btn {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
color: white;
box-shadow: 0 4px 15px rgba(125, 110, 131, 0.3);
}

.preview-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(125, 110, 131, 0.4);
}

.clear-btn {
background: linear-gradient(135deg, #D4A574 0%, #B5A491 100%);
color: white;
box-shadow: 0 4px 15px rgba(212, 165, 116, 0.3);
}

.clear-btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 25px rgba(212, 165, 116, 0.4);
}

.help-text {
font-size: 12px;
color: #7A7A7A;
margin-top: 8px;
font-style: italic;
}

.fade-in {
animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

/* æ–°å¢çš„å®¢è£½åŒ–æç¤ºè¼¸å…¥æ¡†æ¨£å¼ */
.custom-prompt {
margin-top: 12px;
}

.custom-prompt-container {
position: relative;
margin-top: 12px;
margin-bottom: 12px;
border: 2px solid #D4A574;
padding: 12px;
border-radius: 10px;
background-color: rgba(255, 246, 235, 0.5);
}

.prompt-label {
position: absolute;
top: -10px;
left: 15px;
background: #FFFFFF;
padding: 0 8px;
color: #D4A574;
font-weight: 700;
font-size: 12px;
border-radius: 4px;
box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.custom-prompt textarea {
width: 100%;
padding: 10px 15px;
border: 1px solid #E8D7C3;
border-radius: 8px;
font-size: 13px;
transition: all 0.3s ease;
background: rgba(255, 255, 255, 0.9);
min-height: 60px;
resize: vertical;
font-family: inherit;
}

.custom-prompt textarea:focus {
border-color: #D4A574;
box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.2);
outline: none;
}

.custom-prompt .help-text {
font-size: 11px;
color: #9C8B7A;
margin-top: 5px;
font-style: italic;
}

@media (max-width: 768px) {
.container {
padding: 15px;
}

.form-row, .field-row {
flex-direction: column;
gap: 20px;
}

.action-btn {
display: block;
width: 100%;
margin: 10px 0;
}

.header h1 {
font-size: 2.2em;
}

.mode-selector {
flex-direction: column;
gap: 10px;
}

.basic-info, .ai-content {
padding: 25px;
}
}

@media (prefers-color-scheme: dark) {
.original-data {
background: linear-gradient(135deg, #3E3A37 0%, #4A453F 100%);
border-color: #5D5A57;
color: #E8E6E1;
}

.ai-data {
background: linear-gradient(135deg, #373D37 0%, #424A42 100%);
border-color: #5D6B5D;
color: #E8E6E1;
}

.field-header {
color: #E8E6E1;
}
}

.form-group input:valid {
border-color: #A4B5A0;
}

.form-group input:invalid:not(:placeholder-shown) {
border-color: #D4A574;
}

::-webkit-scrollbar {
width: 8px;
}

::-webkit-scrollbar-track {
background: rgba(255, 255, 255, 0.1);
border-radius: 4px;
}

::-webkit-scrollbar-thumb {
background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%);
border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
background: linear-gradient(135deg, #6A5B6F 0%, #897A67 100%);
}
</style>
</head>
<body>
<div class="container">
<!-- Header -->
<div class="header">
<h1>ğŸ­ OEMå®˜ç¶²ç”¢å“ä¸Šæ¶åŠç¶­è­·ç®¡ç†ç³»çµ±</h1>
<div class="mode-selector">
<label for="operationMode">æ“ä½œæ¨¡å¼:</label>
<select id="operationMode" onchange="changeMode()">
<option value="new">æ–°å¢ç”¢å“</option>
<option value="update">ä¿®æ”¹ç”¢å“</option>
</select>
</div>
<div class="mode-indicator mode-new" id="modeIndicator">æ–°å¢æ¨¡å¼</div>
</div>

<!-- Basic Information -->
<div class="basic-info">
<h2>ğŸ“ åŸºæœ¬è³‡è¨Š</h2>

<div class="form-row">
<div class="form-group">
<label for="productModel">ç”¢å“å‹è™Ÿ(Dæ¬„) <span class="required">*</span></label>
<input type="text" id="productModel" placeholder="è«‹è¼¸å…¥ç”¢å“å‹è™Ÿ">
</div>
<div id="checkModelSection">
<button type="button" class="check-btn" onclick="checkProductModel()">æª¢æŸ¥å‹è™Ÿæ˜¯å¦é‡è¤‡</button>
</div>
<div id="loadDataSection" style="display: none;">
<button type="button" class="check-btn" onclick="loadExistingProduct()">è¼‰å…¥è³‡æ–™</button>
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="categoryId">åˆ†é¡ç³»çµ±ID(Bæ¬„) <span class="required">*</span></label>
<select id="categoryId">
<option value="">è¼‰å…¥ä¸­...</option>
</select>
<div class="custom-input-container" id="customCategoryContainer">
<input type="text" id="customCategoryId" placeholder="è«‹è¼¸å…¥æ–°çš„åˆ†é¡ç³»çµ±ID">
</div>
</div>
<div class="form-group">
<label for="productName">ç”¢å“åç¨±(Cæ¬„) <span class="required">*</span></label>
<input type="text" id="productName" placeholder="è«‹è¼¸å…¥ç”¢å“åç¨±">
</div>
</div>

<div class="form-row">
<div class="form-group">
<label for="supplierInfo">å» å•†è³‡æ–™</label>
<textarea id="supplierInfo" rows="3" placeholder="éå¿…å¡«,ä¾›AIåƒè€ƒ"></textarea>
<div class="help-text">å¯æä¾›å» å•†çš„ç”¢å“è¦æ ¼ã€ç‰¹è‰²èªªæ˜ç­‰è³‡æ–™</div>
</div>
</div>

<button type="button" class="generate-btn" onclick="generateAIContent()" id="generateBtn">
ğŸ¤– ç”ŸæˆAIæ–‡æ¡ˆ
</button>
</div>

<!-- Loading -->
<div class="loading" id="loadingDiv">
<div class="loading-content">
<span class="spinner">ğŸ¤–</span>
<span>AI æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆç²¾å½©å…§å®¹,è«‹ç¨å€™...</span>
</div>
</div>

<!-- AI Generated Content -->
<div class="ai-content fade-in" id="aiContent">
<h2>ğŸ¤– AIç”Ÿæˆå…§å®¹</h2>
<div class="warning-text">
âš ï¸ ä»¥ä¸‹å…§å®¹ç”±AIç”Ÿæˆ,è«‹ä»”ç´°ç¢ºèªä¸¦ä¿®æ”¹å¾Œå†å„²å­˜
</div>

<!-- åŸºæœ¬è³‡è¨Š (A E F G Hæ¬„) -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">åŸºæœ¬è³‡è¨Š</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“ç³»çµ±ID(Aæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalSystemId">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“ç³»çµ±ID(Aæ¬„) - AIç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiSystemId" readonly>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“åˆ¥ç¨±(Eæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalAlias">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“åˆ¥ç¨±(Eæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiAlias" rows="3"></textarea>
<button class="refresh-btn" onclick="refreshField('alias')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“åœ–ç‰‡(Fæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalImage">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“åœ–ç‰‡(Fæ¬„) - è‡ªå‹•ç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiImage" readonly>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“åœ–ç‰‡èªªæ˜(Gæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalImageDesc">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“åœ–ç‰‡èªªæ˜(Gæ¬„) - è‡ªå‹•ç”Ÿæˆ</div>
<div class="field-content">
<input type="text" id="aiImageDesc" readonly>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“å·¦ä¸Šè¼ªæ’­åœ–ç‰‡(Hæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalCarouselImage">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“å·¦ä¸Šè¼ªæ’­åœ–ç‰‡(Hæ¬„)</div>
<div class="field-content">
<input type="text" id="aiCarouselImage">
</div>
</div>
</div>
</div>
</div>

<!-- ç”¢å“ä»‹ç´¹ (I J K M N P Q R S V X Yæ¬„) -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">ç”¢å“ä»‹ç´¹</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“ä»‹ç´¹(Iæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalIntroduction">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“ä»‹ç´¹(Iæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiIntroduction" rows="4" placeholder="AIå°‡ç”Ÿæˆ4-5å¥è‹±æ–‡ç”¢å“ä»‹ç´¹,æ¯å¥ä»¥ç”¢å“åç¨±ç•¶ä¸»è©"></textarea>

<!-- ç”¢å“ä»‹ç´¹çš„æç¤ºè¼¸å…¥æ¡† -->
<div class="custom-prompt-container">
    <div class="prompt-label">AIæç¤ºè©</div>
    <div class="custom-prompt">
        <textarea id="introductionPrompt" rows="3" placeholder="è«‹è¼¸å…¥è‡ªè¨‚æç¤ºä»¥æŒ‡å°AIç”Ÿæˆç”¢å“ä»‹ç´¹"></textarea>
        <div class="help-text">ä¾‹å¦‚:å¼·èª¿ç”¢å“è€ç”¨åº¦ã€ç‰¹æ®ŠåŠŸèƒ½ã€ç¨ç‰¹æè³ªã€è¡Œæ¥­æ‡‰ç”¨å ´æ™¯ç­‰</div>
    </div>
</div>
<button class="refresh-btn" onclick="refreshField('introduction')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°-ç¬¬äºŒæ®µä»¥ä¸Š(Jæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalDetailedDesc">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°-ç¬¬äºŒæ®µä»¥ä¸Š(Jæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiDetailedDesc" rows="4" placeholder="AIå°‡ç”Ÿæˆ4-5å¥è‹±æ–‡ç”¢å“ä»‹ç´¹(èˆ‡Iæ¬„å…§å®¹ä¸é‡è¤‡)"></textarea>

<!-- ç”¢å“è©³è¿°çš„æç¤ºè¼¸å…¥æ¡† -->
<div class="custom-prompt-container">
    <div class="prompt-label">AIæç¤ºè©</div>
    <div class="custom-prompt">
        <textarea id="detailedDescPrompt" rows="3" placeholder="è«‹è¼¸å…¥è‡ªè¨‚æç¤ºä»¥æŒ‡å°AIç”Ÿæˆç”¢å“è©³è¿°"></textarea>
        <div class="help-text">ä¾‹å¦‚:è©³è¿°ç”¢å“æ€§èƒ½åƒæ•¸ã€å„ªå‹¢èˆ‡åŒé¡ç”¢å“æ¯”è¼ƒã€ä½¿ç”¨æ¡ˆä¾‹ç­‰</div>
    </div>
</div>
<button class="refresh-btn" onclick="refreshField('detailedDesc')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“ç‰¹æ€§(Kæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalFeatures">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“ç‰¹æ€§(Kæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiFeatures" rows="4"></textarea>
<button class="refresh-btn" onclick="refreshField('features')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°;æ¢åˆ—å¼(ç¬¬äºŒå¼µä¹‹å¾Œ)(Mæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalDetailedDescList">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°;æ¢åˆ—å¼(ç¬¬äºŒå¼µä¹‹å¾Œ)(Mæ¬„)</div>
<div class="field-content">
<textarea id="aiDetailedDescList" rows="4"></textarea>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°(media)_01(Næ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalMediaDesc01">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°(media)_01(Næ¬„)</div>
<div class="field-content">
<textarea id="aiMediaDesc01" rows="4"></textarea>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°01;æ¢åˆ—å¼(Pæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalDetailedDesc01List">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°01;æ¢åˆ—å¼(Pæ¬„)</div>
<div class="field-content">
<textarea id="aiDetailedDesc01List" rows="4"></textarea>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°01;ç´”æ–‡å­—(Qæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalDetailedDesc01Text">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°01;ç´”æ–‡å­—(Qæ¬„)</div>
<div class="field-content">
<textarea id="aiDetailedDesc01Text" rows="4"></textarea>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">è£½ç¨‹æ‡‰ç”¨(Ræ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalApplication">-</div>
</div>
<div class="ai-data">
<div class="field-header">è£½ç¨‹æ‡‰ç”¨(Ræ¬„)</div>
<div class="field-content">
<textarea id="aiApplication" rows="4"></textarea>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è¦æ ¼(Sæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalSpecs">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è¦æ ¼(Sæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiSpecs" rows="4"></textarea>
<button class="refresh-btn" onclick="refreshField('specs')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">MOQ / Country of Origin(Væ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalMOQ">-</div>
</div>
<div class="ai-data">
<div class="field-header">MOQ / Country of Origin(Væ¬„) - é è¨­</div>
<div class="field-content">
<input type="text" id="aiMOQ" value="Made in Taiwan" readonly>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">TAGæ¨™ç±¤(Xæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalTags">-</div>
</div>
<div class="ai-data">
<div class="field-header">TAGæ¨™ç±¤(Xæ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiTags" rows="2" placeholder="AIå°‡ç”Ÿæˆ4-5å€‹SEOé—œéµå­—,ä»¥é€—è™Ÿé€£çµ"></textarea>
<button class="refresh-btn" onclick="refreshField('tags')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">é—œè¯ç”¢å“ç³»çµ±ID(Yæ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalRelatedProducts">-</div>
</div>
<div class="ai-data">
<div class="field-header">é—œè¯ç”¢å“ç³»çµ±ID(Yæ¬„)</div>
<div class="field-content">
<input type="text" id="aiRelatedProducts">
</div>
</div>
</div>
</div>
</div>

<!-- å¤šåª’é«”å…§å®¹ (Læ¬„) -->
<div class="section">
<div class="section-title" onclick="toggleSection(this)">å¤šåª’é«”å…§å®¹</div>
<div class="section-content">
<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°(Media1)(Læ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalMedia1">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°(Media1)(Læ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiMedia1" rows="4" placeholder="æ ¼å¼:Mediaåœ–ç‰‡æª”å::::bottom::Mediaæ¨™é¡Œ::Mediaèªªæ˜æ–‡å­—"></textarea>
<button class="refresh-btn" onclick="refreshField('media1')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°(Media2)(Læ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalMedia2">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°(Media2)(Læ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiMedia2" rows="4" placeholder="æ ¼å¼:Mediaåœ–ç‰‡æª”å::::bottom::Mediaæ¨™é¡Œ::Mediaèªªæ˜æ–‡å­—"></textarea>
<button class="refresh-btn" onclick="refreshField('media2')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>

<div class="field-row">
<div class="original-data">
<div class="field-header">ç”¢å“è©³è¿°(Media3)(Læ¬„) - åŸå§‹è³‡æ–™</div>
<div class="field-content" id="originalMedia3">-</div>
</div>
<div class="ai-data">
<div class="field-header">ç”¢å“è©³è¿°(Media3)(Læ¬„) - AIç”Ÿæˆ<span class="review-badge">è«‹æª¢æŸ¥</span></div>
<div class="field-content">
<textarea id="aiMedia3" rows="4" placeholder="æ ¼å¼:Mediaåœ–ç‰‡æª”å::::bottom::Mediaæ¨™é¡Œ::Mediaèªªæ˜æ–‡å­—"></textarea>
<button class="refresh-btn" onclick="refreshField('media3')">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Action Buttons -->
<div class="action-buttons">
<button type="button" class="action-btn preview-btn" onclick="previewData()">ğŸ‘ï¸ é è¦½è³‡æ–™</button>
<button type="button" class="action-btn save-btn" onclick="saveData()">ğŸ’¾ å„²å­˜ç”¢å“</button>
<button type="button" class="action-btn clear-btn" onclick="clearForm()">ğŸ—‘ï¸ æ¸…ç©ºè¡¨å–®</button>
</div>
</div>

<script>
let isUpdateMode = false;
let currentProductData = {};

// é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    loadCategoryOptions();

    // ç›£è½åˆ†é¡é¸æ“‡è®Šæ›´
    document.getElementById('categoryId').addEventListener('change', handleCategoryChange);

    // Enteréµäº‹ä»¶è™•ç†
    document.getElementById('productModel').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const mode = document.getElementById('operationMode').value;
            if (mode === 'update') {
                loadExistingProduct();
            } else {
                checkProductModel();
            }
        }
    });
});

// è¼‰å…¥åˆ†é¡é¸é …
function loadCategoryOptions() {
    fetch('https://hook.us2.make.com/fqq8b8852xh57vgk0bp9p7wp7vaiof9n', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            action: 'get_category_options'
        })
    })
    .then(response => response.json())
    .then(data => {
        const categorySelect = document.getElementById('categoryId');
        categorySelect.innerHTML = '';

        // æ·»åŠ é è¨­é¸é …
        categorySelect.innerHTML = '<option value="">è«‹é¸æ“‡åˆ†é¡ç³»çµ±ID</option>';

        if (data.success && data.categories) {
            data.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // æ·»åŠ æ–°å¢é¸é …
        const addOption = document.createElement('option');
        addOption.value = 'add_new';
        addOption.textContent = 'æ–°å¢åˆ†é¡ç³»çµ±ID';
        categorySelect.appendChild(addOption);
    })
    .catch(error => {
        console.error('è¼‰å…¥åˆ†é¡é¸é …å¤±æ•—:', error);
        document.getElementById('categoryId').innerHTML = '<option value="">è¼‰å…¥å¤±æ•—</option>';
    });
}

// è™•ç†åˆ†é¡é¸æ“‡è®Šæ›´
function handleCategoryChange() {
    const categorySelect = document.getElementById('categoryId');
    const customContainer = document.getElementById('customCategoryContainer');

    if (categorySelect.value === 'add_new') {
        customContainer.classList.add('show');
        document.getElementById('customCategoryId').focus();
    } else {
        customContainer.classList.remove('show');
    }
}

function changeMode() {
    const mode = document.getElementById('operationMode').value;
    const checkModelSection = document.getElementById('checkModelSection');
    const loadDataSection = document.getElementById('loadDataSection');
    const productModelInput = document.getElementById('productModel');

    if (mode === 'update') {
        switchToUpdateMode();
        checkModelSection.style.display = 'none';
        loadDataSection.style.display = 'block';
        productModelInput.placeholder = 'è«‹è¼¸å…¥è¦ä¿®æ”¹çš„ç”¢å“å‹è™Ÿ';
    } else {
        switchToNewMode();
        checkModelSection.style.display = 'block';
        loadDataSection.style.display = 'none';
        productModelInput.placeholder = 'è«‹è¼¸å…¥ç”¢å“å‹è™Ÿ';
        clearForm();
    }
}

function checkProductModel() {
    const productModel = document.getElementById('productModel').value.trim();
    if (!productModel) {
        alert('è«‹è¼¸å…¥ç”¢å“å‹è™Ÿ');
        return;
    }

    const checkBtn = document.querySelector('#checkModelSection .check-btn');
    checkBtn.disabled = true;
    checkBtn.textContent = 'æª¢æŸ¥ä¸­...';

    console.log('ç™¼é€å‹è™Ÿæª¢æŸ¥è«‹æ±‚åˆ° Make.com:', {
        action: 'check_product_model',
        productModel: productModel
    });

    fetch('https://hook.us2.make.com/fqq8b8852xh57vgk0bp9p7wp7vaiof9n', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            action: 'check_product_model',
            productModel: productModel
        })
    })
    .then(response => {
        console.log('Response status:', response.status);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return response.text();
    })
    .then(rawText => {
        console.log('Raw response text:', rawText);

        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');

        console.log('Cleaned text:', cleanText);

        try {
            const data = JSON.parse(cleanText);
            return data;
        } catch (parseError) {
            console.error('JSON è§£æéŒ¯èª¤:', parseError);
            console.log('å˜—è©¦æ‰‹å‹•ä¿®å¾© JSON...');

            const superCleanText = rawText.replace(/[\x00-\x1F\x7F]/g, ' ');
            const data = JSON.parse(superCleanText);
            return data;
        }
    })
    .then(data => {
        console.log('æ”¶åˆ°çš„æª¢æŸ¥çµæœ:', data);

        if (data.exists) {
            alert('æ­¤ç”¢å“å‹è™Ÿå·²å­˜åœ¨!è«‹ä½¿ç”¨ä¸åŒçš„å‹è™Ÿæˆ–åˆ‡æ›åˆ°ä¿®æ”¹æ¨¡å¼ã€‚');
        } else {
            alert('ç”¢å“å‹è™Ÿå¯ç”¨!');
        }
    })
    .catch(error => {
        console.error('æª¢æŸ¥å¤±æ•—è©³ç´°éŒ¯èª¤:', error);

        if (error.message.includes('JSON')) {
            alert('è³‡æ–™æ ¼å¼éŒ¯èª¤,è«‹æª¢æŸ¥ Make.com å›å‚³çš„è³‡æ–™æ ¼å¼ã€‚è©³ç´°éŒ¯èª¤è«‹æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°ã€‚');
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
            alert('ç¶²è·¯è«‹æ±‚å¤±æ•—,å¯èƒ½æ˜¯CORSå•é¡Œã€‚è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹è©³ç´°éŒ¯èª¤ã€‚');
        } else {
            alert(`æª¢æŸ¥å¤±æ•—: ${error.message}`);
        }
    })
    .finally(() => {
        checkBtn.disabled = false;
        checkBtn.textContent = 'æª¢æŸ¥å‹è™Ÿæ˜¯å¦é‡è¤‡';
    });
}

function loadExistingProduct() {
    const productModel = document.getElementById('productModel').value.trim();
    if (!productModel) {
        alert('è«‹è¼¸å…¥ç”¢å“å‹è™Ÿ');
        return;
    }

    const loadBtn = document.querySelector('#loadDataSection .check-btn');
    loadBtn.disabled = true;
    loadBtn.textContent = 'è¼‰å…¥ä¸­...';

    console.log('ç™¼é€è«‹æ±‚åˆ° Make.com:', {
        action: 'load',
        productModel: productModel
    });

    fetch('https://hook.us2.make.com/fqq8b8852xh57vgk0bp9p7wp7vaiof9n', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            action: 'load',
            productModel: productModel
        })
    })
    .then(response => {
        console.log('Response status:', response.status);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return response.text();
    })
    .then(rawText => {
        console.log('Raw response text:', rawText);

        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');

        console.log('Cleaned text:', cleanText);

        try {
            const data = JSON.parse(cleanText);
            return data;
        } catch (parseError) {
            console.error('JSON è§£æéŒ¯èª¤:', parseError);
            console.log('å˜—è©¦æ‰‹å‹•ä¿®å¾© JSON...');

            const superCleanText = rawText.replace(/[\x00-\x1F\x7F]/g, ' ');
            const data = JSON.parse(superCleanText);
            return data;
        }
    })
    .then(data => {
        console.log('æ”¶åˆ°çš„è³‡æ–™:', data);

        if (data.success && data.data) {
            loadExistingData(data.data);
            alert('ç”¢å“è³‡æ–™è¼‰å…¥æˆåŠŸ!');
        } else {
            console.log('è³‡æ–™æ ¼å¼å•é¡Œ:', data);
            alert('æ‰¾ä¸åˆ°æ­¤ç”¢å“å‹è™Ÿçš„è³‡æ–™');
        }
    })
    .catch(error => {
        console.error('è¼‰å…¥å¤±æ•—è©³ç´°éŒ¯èª¤:', error);

        if (error.message.includes('JSON')) {
            alert('è³‡æ–™æ ¼å¼éŒ¯èª¤,è«‹æª¢æŸ¥ Make.com å›å‚³çš„è³‡æ–™æ ¼å¼ã€‚è©³ç´°éŒ¯èª¤è«‹æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°ã€‚');
        } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
            alert('ç¶²è·¯è«‹æ±‚å¤±æ•—,å¯èƒ½æ˜¯CORSå•é¡Œã€‚è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°æŸ¥çœ‹è©³ç´°éŒ¯èª¤ã€‚');
        } else {
            alert(`è¼‰å…¥å¤±æ•—: ${error.message}`);
        }
    })
    .finally(() => {
        loadBtn.disabled = false;
        loadBtn.textContent = 'è¼‰å…¥è³‡æ–™';
    });
}

function switchToUpdateMode() {
    isUpdateMode = true;
    const indicator = document.getElementById('modeIndicator');
    indicator.textContent = 'æ›´æ–°æ¨¡å¼';
    indicator.className = 'mode-indicator mode-update';
}

function switchToNewMode() {
    isUpdateMode = false;
    const indicator = document.getElementById('modeIndicator');
    indicator.textContent = 'æ–°å¢æ¨¡å¼';
    indicator.className = 'mode-indicator mode-new';

    // è§£é–åˆ†é¡ç³»çµ±IDå’Œç”¢å“åç¨±æ¬„ä½
    document.getElementById('categoryId').disabled = false;
    document.getElementById('customCategoryId').disabled = false;
    document.getElementById('productName').disabled = false;
}

function loadExistingData(productData) {
    // è¨­å®šåˆ†é¡ç³»çµ±ID
    const categorySelect = document.getElementById('categoryId');
    const categoryValue = productData.categoryId || '';

    // æª¢æŸ¥åˆ†é¡æ˜¯å¦å­˜åœ¨æ–¼é¸é …ä¸­
    let categoryExists = false;
    for (let option of categorySelect.options) {
        if (option.value === categoryValue) {
            categoryExists = true;
            break;
        }
    }

    if (categoryExists) {
        categorySelect.value = categoryValue;
    } else if (categoryValue) {
        // å¦‚æœåˆ†é¡ä¸å­˜åœ¨,é¸æ“‡æ–°å¢é¸é …ä¸¦å¡«å…¥è‡ªè¨‚æ¬„ä½
        categorySelect.value = 'add_new';
        document.getElementById('customCategoryId').value = categoryValue;
        document.getElementById('customCategoryContainer').classList.add('show');
    }

    document.getElementById('productName').value = productData.productName || '';

    // åœ¨æ›´æ–°æ¨¡å¼ä¸‹é–å®šåˆ†é¡ç³»çµ±IDã€è‡ªè¨‚åˆ†é¡å’Œç”¢å“åç¨±
    document.getElementById('categoryId').disabled = true;
    document.getElementById('customCategoryId').disabled = true;
    document.getElementById('productName').disabled = true;

    // è¼‰å…¥åŸå§‹è³‡æ–™ - åŒ…å«æ–°å¢çš„æ¬„ä½
    document.getElementById('originalSystemId').textContent = productData.systemId || '-';
    document.getElementById('originalAlias').textContent = productData.alias || '-';
    document.getElementById('originalImage').textContent = productData.image || '-';
    document.getElementById('originalImageDesc').textContent = productData.imageDesc || '-';
    document.getElementById('originalCarouselImage').textContent = productData.carouselImage || '-';
    document.getElementById('originalIntroduction').textContent = productData.introduction || '-';
    document.getElementById('originalDetailedDesc').textContent = productData.detailedDesc || '-';
    document.getElementById('originalFeatures').textContent = productData.features || '-';
    document.getElementById('originalDetailedDescList').textContent = productData.detailedDescList || '-';
    document.getElementById('originalMediaDesc01').textContent = productData.mediaDesc01 || '-';
    document.getElementById('originalDetailedDesc01List').textContent = productData.detailedDesc01List || '-';
    document.getElementById('originalDetailedDesc01Text').textContent = productData.detailedDesc01Text || '-';
    document.getElementById('originalApplication').textContent = productData.application || '-';
    document.getElementById('originalMedia1').textContent = productData.media1 || '-';
    document.getElementById('originalMedia2').textContent = productData.media2 || '-';
    document.getElementById('originalMedia3').textContent = productData.media3 || '-';
    document.getElementById('originalSpecs').textContent = productData.specs || '-';
    document.getElementById('originalMOQ').textContent = productData.moq || '-';
    document.getElementById('originalTags').textContent = productData.tags || '-';
    document.getElementById('originalRelatedProducts').textContent = productData.relatedProducts || '-';

    // è¼‰å…¥AIæ¬„ä½ - åŒ…å«æ–°å¢çš„æ¬„ä½
    document.getElementById('aiSystemId').value = productData.systemId || '';
    document.getElementById('aiAlias').value = productData.alias || '';
    document.getElementById('aiImage').value = productData.image || '';
    document.getElementById('aiImageDesc').value = productData.imageDesc || '';
    document.getElementById('aiCarouselImage').value = productData.carouselImage || '';
    document.getElementById('aiIntroduction').value = productData.introduction || '';
    document.getElementById('aiDetailedDesc').value = productData.detailedDesc || '';
    document.getElementById('aiFeatures').value = productData.features || '';
    document.getElementById('aiDetailedDescList').value = productData.detailedDescList || '';
    document.getElementById('aiMediaDesc01').value = productData.mediaDesc01 || '';
    document.getElementById('aiDetailedDesc01List').value = productData.detailedDesc01List || '';
    document.getElementById('aiDetailedDesc01Text').value = productData.detailedDesc01Text || '';
    document.getElementById('aiApplication').value = productData.application || '';
    document.getElementById('aiMedia1').value = productData.media1 || '';
    document.getElementById('aiMedia2').value = productData.media2 || '';
    document.getElementById('aiMedia3').value = productData.media3 || '';
    document.getElementById('aiSpecs').value = productData.specs || '';
    document.getElementById('aiMOQ').value = productData.moq || 'Made in Taiwan';
    document.getElementById('aiTags').value = productData.tags || '';
    document.getElementById('aiRelatedProducts').value = productData.relatedProducts || '';

    currentProductData = productData;
}

function generateAIContent() {
    const productModel = document.getElementById('productModel').value.trim();
    const productName = document.getElementById('productName').value.trim();

    // å–å¾—åˆ†é¡ç³»çµ±ID(è€ƒæ…®è‡ªè¨‚è¼¸å…¥)
    let categoryId;
    const categorySelect = document.getElementById('categoryId');
    if (categorySelect.value === 'add_new') {
        categoryId = document.getElementById('customCategoryId').value.trim();
    } else {
        categoryId = categorySelect.value.trim();
    }

    if (!productModel || !categoryId || !productName) {
        alert('è«‹å¡«å…¥å¿…å¡«æ¬„ä½');
        return;
    }

    showLoading();

    const requestData = {
        action: "generate_all",
        productModel: productModel,
        categoryId: categoryId,
        productName: productName
    };

    const supplierInfo = document.getElementById('supplierInfo').value.trim();
    if (supplierInfo) {
        requestData.supplierInfo = supplierInfo;
    }

    // ç²å–è‡ªè¨‚æç¤º (å¦‚æœæœ‰)
    const introductionPrompt = document.getElementById('introductionPrompt').value.trim();
    if (introductionPrompt) {
        requestData.introductionPrompt = introductionPrompt;
    }
    
    // ç²å–è©³è¿°æç¤ºè© (å¦‚æœæœ‰)
    const detailedDescPrompt = document.getElementById('detailedDescPrompt').value.trim();
    if (detailedDescPrompt) {
        requestData.detailedDescPrompt = detailedDescPrompt;
    }

    if (isUpdateMode && currentProductData) {
        requestData.existingData = currentProductData;
    }

    console.log('ç™¼é€AIç”Ÿæˆè«‹æ±‚:', requestData);

    fetch('https://hook.us2.make.com/acmcfkp1qg2l8kzbheuprgbl0tp2dk4v', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        console.log('AI Response status:', response.status);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return response.text();
    })
    .then(rawText => {
        console.log('AI Raw response:', rawText);

        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');

        const data = JSON.parse(cleanText);
        return data;
    })
    .then(data => {
        console.log('AIç”Ÿæˆçµæœ:', data);

        if (data.success && data.generated) {
            fillAIGeneratedContent(data.generated);
            alert('AIæ–‡æ¡ˆç”ŸæˆæˆåŠŸ!');
        } else {
            alert('AIç”Ÿæˆå¤±æ•—,è«‹ç¨å¾Œå†è©¦');
        }
    })
    .catch(error => {
        console.error('AIç”Ÿæˆå¤±æ•—:', error);
        alert(`AIç”Ÿæˆå¤±æ•—: ${error.message}`);
    })
    .finally(() => {
        hideLoading();
    });
}

function fillAIGeneratedContent(generated) {
    // å¡«å…¥OEMç³»çµ±çš„æ¬„ä½
    if (generated.systemId) document.getElementById('aiSystemId').value = generated.systemId;
    if (generated.alias) document.getElementById('aiAlias').value = generated.alias;
    if (generated.image) document.getElementById('aiImage').value = generated.image;
    if (generated.imageDesc) document.getElementById('aiImageDesc').value = generated.imageDesc;
    if (generated.introduction) document.getElementById('aiIntroduction').value = generated.introduction;
    if (generated.detailedDesc) document.getElementById('aiDetailedDesc').value = generated.detailedDesc;
    if (generated.features) document.getElementById('aiFeatures').value = generated.features;
    if (generated.media1) document.getElementById('aiMedia1').value = generated.media1;
    if (generated.media2) document.getElementById('aiMedia2').value = generated.media2;
    if (generated.media3) document.getElementById('aiMedia3').value = generated.media3;
    if (generated.specs) document.getElementById('aiSpecs').value = generated.specs;
    if (generated.tags) document.getElementById('aiTags').value = generated.tags;
}

function refreshField(fieldName) {
    const button = event.target;
    button.disabled = true;
    button.textContent = 'ğŸ”„ ç”Ÿæˆä¸­...';

    const productModel = document.getElementById('productModel').value.trim();
    const productName = document.getElementById('productName').value.trim();

    if (!productModel || !productName) {
        alert('è«‹å…ˆå¡«å…¥ç”¢å“å‹è™Ÿå’Œç”¢å“åç¨±');
        button.disabled = false;
        button.textContent = 'ğŸ”„ é‡æ–°ç”Ÿæˆ';
        return;
    }

    const requestData = {
        action: "generate_field",
        fieldName: fieldName,
        productModel: productModel,
        productName: productName
    };

    // ç²å–è‡ªè¨‚æç¤º (å¦‚æœæœ‰,æ ¹æ“šæ¬„ä½é¸æ“‡ä¸åŒæç¤ºè¼¸å…¥æ¡†)
    if (fieldName === 'introduction') {
        const introductionPrompt = document.getElementById('introductionPrompt').value.trim();
        if (introductionPrompt) {
            requestData.customPrompt = introductionPrompt;
        }
    } else if (fieldName === 'detailedDesc') {
        const detailedDescPrompt = document.getElementById('detailedDescPrompt').value.trim();
        if (detailedDescPrompt) {
            requestData.customPrompt = detailedDescPrompt;
        }
    }

    const supplierInfo = document.getElementById('supplierInfo').value.trim();
    if (supplierInfo) {
        requestData.supplierInfo = supplierInfo;
    }

    const currentValue = getCurrentFieldValue(fieldName);
    if (currentValue) {
        requestData.currentValue = currentValue;
    }

    if (fieldName.startsWith('media')) {
        const otherMedias = getOtherMediaContent(fieldName);
        if (Object.keys(otherMedias).length > 0) {
            requestData.otherMediaContent = otherMedias;
        }
    }

    // å¦‚æœæ˜¯é‡æ–°ç”ŸæˆJæ¬„(detailedDesc),åŒæ™‚å‚³é€Iæ¬„(introduction)çš„è³‡æ–™
    if (fieldName === 'detailedDesc') {
        const introductionValue = getCurrentFieldValue('introduction');
        if (introductionValue) {
            requestData.introductionReference = introductionValue;
        }
    }

    console.log('å€‹åˆ¥æ¬„ä½é‡æ–°ç”Ÿæˆè«‹æ±‚:', requestData);

    fetch('https://hook.us2.make.com/acmcfkp1qg2l8kzbheuprgbl0tp2dk4v', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.text();
    })
    .then(rawText => {
        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');

        const data = JSON.parse(cleanText);
        return data;
    })
    .then(data => {
        console.log(`${fieldName} é‡æ–°ç”Ÿæˆçµæœ:`, data);

        if (data.success && data.generated) {
            updateSpecificField(fieldName, data.generated[fieldName]);
        } else {
            alert('é‡æ–°ç”Ÿæˆå¤±æ•—,è«‹ç¨å¾Œå†è©¦');
        }
    })
    .catch(error => {
        console.error('é‡æ–°ç”Ÿæˆå¤±æ•—:', error);
        alert(`é‡æ–°ç”Ÿæˆå¤±æ•—: ${error.message}`);
    })
    .finally(() => {
        button.disabled = false;
        button.textContent = 'ğŸ”„ é‡æ–°ç”Ÿæˆ';
    });
}

function getCurrentFieldValue(fieldName) {
    // OEMç³»çµ±çš„æ¬„ä½å°æ‡‰
    const fieldMap = {
        'alias': 'aiAlias',
        'introduction': 'aiIntroduction',
        'detailedDesc': 'aiDetailedDesc',
        'features': 'aiFeatures',
        'media1': 'aiMedia1',
        'media2': 'aiMedia2',
        'media3': 'aiMedia3',
        'specs': 'aiSpecs',
        'tags': 'aiTags'
    };

    const elementId = fieldMap[fieldName];
    if (elementId) {
        const element = document.getElementById(elementId);
        return element ? element.value : '';
    }
    return '';
}

function getOtherMediaContent(currentFieldName) {
    const mediaFields = ['media1', 'media2', 'media3'];
    const otherMedias = mediaFields.filter(field => field !== currentFieldName);

    const otherContent = {};
    otherMedias.forEach(field => {
        const content = getCurrentFieldValue(field);
        if (content) {
            otherContent[field] = content;
        }
    });

    return otherContent;
}

function updateSpecificField(fieldName, newValue) {
    // OEMç³»çµ±çš„æ¬„ä½å°æ‡‰
    const fieldMap = {
        'alias': 'aiAlias',
        'introduction': 'aiIntroduction',
        'detailedDesc': 'aiDetailedDesc',
        'features': 'aiFeatures',
        'media1': 'aiMedia1',
        'media2': 'aiMedia2',
        'media3': 'aiMedia3',
        'specs': 'aiSpecs',
        'tags': 'aiTags'
    };

    const elementId = fieldMap[fieldName];
    if (elementId && newValue) {
        const element = document.getElementById(elementId);
        if (element) {
            element.value = newValue;
        }
    }
}

function showLoading() {
    document.getElementById('loadingDiv').classList.add('show');
    document.getElementById('generateBtn').disabled = true;
    document.getElementById('generateBtn').textContent = 'ğŸ¤– ç”Ÿæˆä¸­...';
}

function hideLoading() {
    document.getElementById('loadingDiv').classList.remove('show');
    document.getElementById('generateBtn').disabled = false;
    document.getElementById('generateBtn').textContent = 'ğŸ¤– ç”ŸæˆAIæ–‡æ¡ˆ';
}

function toggleSection(element) {
    const section = element.parentElement;
    section.classList.toggle('collapsed');
}

function previewData() {
    const data = collectFormData();

    if (!data.productModel || !data.productName) {
        alert('è«‹è‡³å°‘å¡«å…¥ç”¢å“å‹è™Ÿå’Œç”¢å“åç¨±æ‰èƒ½é è¦½');
        return;
    }

    const previewWindow = window.open('', '_blank', 'width=1200,height=800,scrollbars=yes');
    previewWindow.document.write(generateProductPreviewHTML(data));
}

function generateProductPreviewHTML(data) {
    const formatFeatures = (features) => {
        if (!features) return '';

        const lines = features.split('\n').filter(line => line.trim());
        return lines.map(line => {
            const cleanLine = line.replace(/^[-â€¢*]\s*/, '').trim();
            return `<li>${cleanLine}</li>`;
        }).join('');
    };

    const formatSpecs = (specs) => {
        if (!specs) return '<tr><td colspan="2">è¦æ ¼è³‡è¨Šå¾…æ›´æ–°</td></tr>';

        const lines = specs.split('\n').filter(line => line.trim());
        let tableRows = '';

        lines.forEach(line => {
            if (line.includes(':') || line.includes('|')) {
                const parts = line.split(/[:|]/).map(part => part.trim());
                if (parts.length >= 2) {
                    tableRows += `<tr><td style="background: #f5f5f5; font-weight: bold; width: 120px;">${parts[0]}</td><td>${parts[1]}</td></tr>`;
                }
            } else if (line.trim()) {
                tableRows += `<tr><td colspan="2">${line}</td></tr>`;
            }
        });

        return tableRows || '<tr><td colspan="2">è¦æ ¼è³‡è¨Šå¾…æ›´æ–°</td></tr>';
    };

    const parseMediaContent = (mediaData) => {
        let mediaHTML = '';

        [mediaData.media1, mediaData.media2, mediaData.media3].forEach((media, index) => {
            if (media && media.trim()) {
                const parts = media.split('::::');

                if (parts.length >= 2) {
                    const imageName = parts[0].trim();
                    const remaining = parts[1];

                    const doubleParts = remaining.split('::');

                    if (doubleParts.length >= 3) {
                        const position = doubleParts[0].trim();
                        const title = doubleParts[1].trim();
                        const content = doubleParts.slice(2).join('::').trim();

                        mediaHTML += `
                            <div class="media-section">
                                <h3 class="media-title">${title}</h3>
                                <div class="media-content">
                                    ${content.replace(/\n/g, '<br>')}
                                </div>
                                <div class="media-image">
                                    <div class="image-placeholder">
                                        <span>ğŸ“· ${imageName}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        mediaHTML += `
                            <div class="media-section">
                                <h3 class="media-title">ç”¢å“è³‡è¨Š ${index + 1}</h3>
                                <div class="media-content">
                                    ${remaining.replace(/\n/g, '<br>')}
                                </div>
                                <div class="media-image">
                                    <div class="image-placeholder">
                                        <span>ğŸ“· ${imageName}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    const lines = media.split('\n').filter(line => line.trim());
                    let title = `ç”¢å“è³‡è¨Š ${index + 1}`;
                    let content = media;

                    if (lines.length > 1 && lines[0].length < 50) {
                        title = lines[0].trim();
                        content = lines.slice(1).join('\n');
                    }

                    mediaHTML += `
                        <div class="media-section">
                            <h3 class="media-title">${title}</h3>
                            <div class="media-content">
                                ${content.replace(/\n/g, '<br>')}
                            </div>
                            <div class="media-image">
                                <div class="image-placeholder">
                                    <span>ğŸ“· ç”¢å“åœ–ç‰‡ ${index + 1}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
        });

        return mediaHTML;
    };

    return `<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${data.productName} | ç”¢å“é è¦½</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: white; }
        .preview-header { background: linear-gradient(135deg, #7D6E83 0%, #9C8B7A 100%); color: white; padding: 10px 0; text-align: center; font-size: 14px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .product-header { display: flex; gap: 30px; margin-bottom: 30px; }
        .product-images { flex: 0 0 300px; }
        .main-image { width: 100%; height: 250px; background: white; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; border-radius: 4px; }
        .main-image img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .image-placeholder { color: #999; font-size: 16px; }
        .thumbnail-row { display: flex; gap: 8px; }
        .thumbnail { width: 60px; height: 60px; border: 1px solid #ddd; background: #f8f9fa; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #999; border-radius: 4px; }
        .product-info { flex: 1; }
        .product-title { font-size: 24px; color: #333; margin-bottom: 8px; font-weight: normal; }
        .product-model { color: #666; margin-bottom: 5px; font-size: 14px; }
        .product-alias { color: #666; margin-bottom: 15px; font-size: 14px; }
        .description { font-size: 14px; line-height: 1.6; color: #555; margin-bottom: 20px; }
        .inquire-btn { background: #A4B5A0; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; display: inline-flex; align-items: center; gap: 5px; }
        .section { margin-bottom: 30px; }
        .section-title { font-size: 18px; color: #333; margin-bottom: 15px; font-weight: normal; }
        .features-list { list-style: none; padding: 0; }
        .features-list li { padding: 8px 0; border-bottom: 1px solid #f0f0f0; position: relative; padding-left: 20px; font-size: 14px; color: #555; }
        .features-list li::before { content: "â—"; position: absolute; left: 0; color: #333; }
        .specs-table { width: 100%; border-collapse: collapse; border: 1px solid #ddd; font-size: 14px; }
        .specs-table td { padding: 10px; border: 1px solid #ddd; vertical-align: top; }
        .media-section { margin-bottom: 40px; border-top: 1px solid #eee; padding-top: 30px; }
        .media-title { font-size: 18px; color: #333; margin-bottom: 15px; font-weight: normal; }
        .media-content { font-size: 14px; line-height: 1.6; color: #555; margin-bottom: 20px; }
        .media-image { text-align: center; margin-bottom: 20px; }
        .media-image .image-placeholder { width: 100%; max-width: 600px; height: 300px; background: #f8f9fa; border: 2px dashed #ddd; display: flex; align-items: center; justify-content: center; color: #999; font-size: 16px; border-radius: 8px; margin: 0 auto; }
        .close-button { position: fixed; top: 20px; right: 20px; background: #7D6E83; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 12px; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .close-button:hover { background: #6A5B6F; }
        .moq-info { font-size: 14px; color: #555; line-height: 1.6; margin-bottom: 20px; }
        @media (max-width: 768px) { .product-header { flex-direction: column; gap: 20px; } .product-images { flex: none; } .container { padding: 15px; } }
    </style>
</head>
<body>
    <div class="preview-header">ç”¢å“é é¢é è¦½ - æ¨¡æ“¬æ­£å¼ç¶²ç«™å‘ˆç¾æ•ˆæœ</div>
    <button class="close-button" onclick="window.close()">é—œé–‰</button>
    <div class="container">
        <div class="product-header">
            <div class="product-images">
                <div class="main-image">
                    ${data.image ? `<img src="${data.image}" alt="${data.productName}">` : `<div class="image-placeholder">ç”¢å“ä¸»åœ–</div>`}
                </div>
                <div class="thumbnail-row">
                    <div class="thumbnail">åœ–1</div>
                    <div class="thumbnail">åœ–2</div>
                    <div class="thumbnail">åœ–3</div>
                    <div class="thumbnail">åœ–4</div>
                </div>
            </div>
            <div class="product-info">
                <h1 class="product-title">${data.productName || 'ç”¢å“åç¨±å¾…è¨­å®š'}</h1>
                <div class="product-model">${data.productModel || 'ç”¢å“å‹è™Ÿå¾…è¨­å®š'}</div>
                ${data.alias ? `<div class="product-alias">${data.alias}</div>` : ''}
                ${data.introduction ? `<div class="description">${data.introduction.replace(/\n/g, '<br>')}</div>` : ''}
                <button class="inquire-btn">INQUIRE NOW</button>
            </div>
        </div>
        ${data.detailedDesc ? `<div class="section"><h2 class="section-title">Product Details</h2><div class="description">${data.detailedDesc.replace(/\n/g, '<br>')}</div></div>` : ''}
        ${data.features ? `<div class="section"><h2 class="section-title">Features</h2><ul class="features-list">${formatFeatures(data.features)}</ul></div>` : ''}
        ${data.specs ? `<div class="section"><h2 class="section-title">Specification</h2><table class="specs-table">${formatSpecs(data.specs)}</table></div>` : ''}
        ${data.moq ? `<div class="section"><h2 class="section-title">MOQ / Country of Origin</h2><div class="moq-info">${data.moq}</div></div>` : ''}
        ${parseMediaContent(data)}
    </div>
</body>
</html>`;
}

function collectFormData() {
    // å–å¾—åˆ†é¡ç³»çµ±ID(è€ƒæ…®è‡ªè¨‚è¼¸å…¥)
    let categoryId;
    const categorySelect = document.getElementById('categoryId');
    if (categorySelect.value === 'add_new') {
        categoryId = document.getElementById('customCategoryId').value.trim();
    } else {
        categoryId = categorySelect.value.trim();
    }

    return {
        productModel: document.getElementById('productModel').value.trim(),
        categoryId: categoryId,
        productName: document.getElementById('productName').value.trim(),
        supplierInfo: document.getElementById('supplierInfo').value.trim(),
        systemId: document.getElementById('aiSystemId').value,
        alias: document.getElementById('aiAlias').value,
        image: document.getElementById('aiImage').value,
        imageDesc: document.getElementById('aiImageDesc').value,
        carouselImage: document.getElementById('aiCarouselImage').value,
        introduction: document.getElementById('aiIntroduction').value,
        detailedDesc: document.getElementById('aiDetailedDesc').value,
        features: document.getElementById('aiFeatures').value,
        detailedDescList: document.getElementById('aiDetailedDescList').value,
        mediaDesc01: document.getElementById('aiMediaDesc01').value,
        detailedDesc01List: document.getElementById('aiDetailedDesc01List').value,
        detailedDesc01Text: document.getElementById('aiDetailedDesc01Text').value,
        application: document.getElementById('aiApplication').value,
        media1: document.getElementById('aiMedia1').value,
        media2: document.getElementById('aiMedia2').value,
        media3: document.getElementById('aiMedia3').value,
        specs: document.getElementById('aiSpecs').value,
        moq: document.getElementById('aiMOQ').value,
        tags: document.getElementById('aiTags').value,
        relatedProducts: document.getElementById('aiRelatedProducts').value
    };
}

function saveData() {
    const data = collectFormData();

    if (!data.productModel || !data.categoryId || !data.productName) {
        alert('è«‹å¡«å…¥æ‰€æœ‰å¿…å¡«æ¬„ä½');
        return;
    }

    const action = isUpdateMode ? 'æ›´æ–°' : 'æ–°å¢';
    if (!confirm(`ç¢ºå®šè¦${action}æ­¤ç”¢å“è³‡æ–™å—?`)) {
        return;
    }

    const saveData = {
        action: isUpdateMode ? "update_product" : "save_product",
        mode: isUpdateMode ? "update" : "new",  
        productModel: data.productModel,
        categoryId: data.categoryId,
        productName: data.productName,
        supplierInfo: data.supplierInfo,
        systemId: data.systemId,
        alias: data.alias,
        image: data.image,
        imageDesc: data.imageDesc,
        carouselImage: data.carouselImage,
        introduction: data.introduction,
        detailedDesc: data.detailedDesc,
        features: data.features,
        detailedDescList: data.detailedDescList,
        mediaDesc01: data.mediaDesc01,
        detailedDesc01List: data.detailedDesc01List,
        detailedDesc01Text: data.detailedDesc01Text,
        application: data.application,
        media1: data.media1,
        media2: data.media2,
        media3: data.media3,
        specs: data.specs,
        moq: data.moq,
        tags: data.tags,
        relatedProducts: data.relatedProducts
    };

    console.log('å„²å­˜è³‡æ–™åˆ°Make.com:', saveData);

    const saveBtn = document.querySelector('.save-btn');
    const originalText = saveBtn.textContent;
    saveBtn.disabled = true;
    saveBtn.textContent = 'å„²å­˜ä¸­...';

    fetch('https://hook.us2.make.com/uzlh920e2ejv3faagi2q618vfte50yhj', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(saveData)
    })
    .then(response => {
        console.log('Save response status:', response.status);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        return response.text();
    })
    .then(rawText => {
        console.log('Save response:', rawText);

        const cleanText = rawText
            .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
            .replace(/\r\n/g, '\\n')
            .replace(/\r/g, '\\n')
            .replace(/\n/g, '\\n')
            .replace(/\t/g, '\\t');

        const result = JSON.parse(cleanText);
        return result;
    })
    .then(result => {
        if (result.success) {
            alert(`ç”¢å“è³‡æ–™å·²${action}æˆåŠŸ!`);

            if (isUpdateMode) {
                if (confirm('æ˜¯å¦è¦æ¸…ç©ºè¡¨å–®ä»¥ä¿®æ”¹ä¸‹ä¸€å€‹ç”¢å“?')) {
                    clearForm();
                }
            } else {
                if (confirm('æ˜¯å¦è¦æ¸…ç©ºè¡¨å–®ä»¥æ–°å¢ä¸‹ä¸€å€‹ç”¢å“?')) {
                    clearForm();
                }
            }
        } else {
            alert(`å„²å­˜å¤±æ•—: ${result.message || 'æœªçŸ¥éŒ¯èª¤'}`);
        }
    })
    .catch(error => {
        console.error('å„²å­˜å¤±æ•—:', error);
        alert(`å„²å­˜å¤±æ•—: ${error.message}`);
    })
    .finally(() => {
        saveBtn.disabled = false;
        saveBtn.textContent = originalText;
    });
}

function clearForm() {
    if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™å—?æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
        return;
    }

    // æ¸…ç©ºåŸºæœ¬æ¬„ä½
    document.getElementById('productModel').value = '';
    document.getElementById('productName').value = '';
    document.getElementById('supplierInfo').value = '';
    document.getElementById('introductionPrompt').value = '';
    document.getElementById('detailedDescPrompt').value = '';

    // é‡è¨­åˆ†é¡é¸æ“‡
    const categorySelect = document.getElementById('categoryId');
    categorySelect.value = '';
    document.getElementById('customCategoryId').value = '';
    document.getElementById('customCategoryContainer').classList.remove('show');

    // æ¸…ç©ºAIæ¬„ä½ - åŒ…å«æ–°å¢çš„æ¬„ä½
    const aiFields = [
        'aiSystemId', 'aiAlias', 'aiImage', 'aiImageDesc', 'aiCarouselImage',
        'aiIntroduction', 'aiDetailedDesc', 'aiFeatures',
        'aiDetailedDescList', 'aiMediaDesc01', 'aiDetailedDesc01List', 
        'aiDetailedDesc01Text', 'aiApplication',
        'aiMedia1', 'aiMedia2', 'aiMedia3', 'aiSpecs', 'aiTags', 'aiRelatedProducts'
    ];

    aiFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.value = '';
        }
    });

    // é‡è¨­MOQç‚ºé è¨­å€¼
    document.getElementById('aiMOQ').value = 'Made in Taiwan';

    // æ¸…ç©ºåŸå§‹è³‡æ–™ - åŒ…å«æ–°å¢çš„æ¬„ä½
    const originalFields = [
        'originalSystemId', 'originalAlias', 'originalImage', 'originalImageDesc', 'originalCarouselImage',
        'originalIntroduction', 'originalDetailedDesc', 'originalFeatures',
        'originalDetailedDescList', 'originalMediaDesc01', 'originalDetailedDesc01List',
        'originalDetailedDesc01Text', 'originalApplication',
        'originalMedia1', 'originalMedia2', 'originalMedia3', 'originalSpecs', 'originalMOQ', 'originalTags', 'originalRelatedProducts'
    ];

    originalFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            element.textContent = '-';
        }
    });

    // æ¸…ç©ºç•¶å‰ç”¢å“è³‡æ–™
    currentProductData = {};

    // æ ¹æ“šç•¶å‰æ¨¡å¼æ±ºå®šå¾ŒçºŒè¡Œç‚º
    if (isUpdateMode) {
        // ä¿®æ”¹æ¨¡å¼ä¸‹æ¸…ç©ºå¾Œ,è§£é–ç›¸é—œæ¬„ä½ä»¥ä¾¿è¼‰å…¥æ–°ç”¢å“
        document.getElementById('categoryId').disabled = false;
        document.getElementById('customCategoryId').disabled = false;
        document.getElementById('productName').disabled = false;
        
        // æ¸…ç©ºç”¢å“å‹è™Ÿä»¥ä¾¿è¼¸å…¥æ–°çš„å‹è™Ÿ
        document.getElementById('productModel').value = '';
    }
    
    // é‡æ–°è¼‰å…¥åˆ†é¡é¸é …
    loadCategoryOptions();
}
</script>
</body>
</html>
